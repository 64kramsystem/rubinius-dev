#!/bin/sh

PREFIX=`echo $0 | sed -e 's/shotgun\/rubinius//'`

REAL=${PREFIX}shotgun/rubinius.bin

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${PREFIX}shotgun/lib
export LD_LIBRARY_PATH_64=$LD_LIBRARY_PATH_64:${PREFIX}shotgun/lib
export SH_LIB=$SH_LIB:${PREFIX}shotgun/lib
export LIBPATH=$LIBPATH:${PREFIX}shotgun/lib
export PATH=$PATH:${PREFIX}shotgun/lib
export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:${PREFIX}shotgun/lib

if [ "x${PREFIX}" != "x" ]; then
  
  if [ "x${RBX_PREFIX}" = "x" ]; then
    export RBX_PREFIX=${PREFIX}
  fi

  if [ "x${RBX_RUNTIME}" = "x" ]; then
    export RBX_RUNTIME=${PREFIX}runtime/
  fi

  if [ "x${RBX_BOOTSTRAP}" = "x" ]; then
    export RBX_BOOTSTRAP=${RBX_RUNTIME}bootstrap
  fi

  if [ "x${RBX_COMPILER}" = "x" ]; then
    export RBX_COMPILER=${RBX_RUNTIME}compiler
  fi

  if [ "x${RBX_CORE}" = "x" ]; then
    export RBX_CORE=${RBX_RUNTIME}core
  fi

  if [ "x${RBX_LOADER}" = "x" ]; then
    export RBX_LOADER=${RBX_RUNTIME}loader.rbc
  fi

  if [ "x${RBX_PLATFORM}" = "x" ]; then
    export RBX_PLATFORM=${RBX_RUNTIME}platform
  fi
fi

if test "x$1" = "x--gdb"; then
  shift
  exec gdb -x ${PREFIX}shotgun/gdbstartup --args /dev/null "$@"
elif test "x$1" = "x--valgrind"; then
  shift
  exec valgrind -v $REAL "$@"
else
  exec $REAL "$@"
fi

#!/usr/bin/env ruby

ITERATIONS = 3

#['ruby','shotgun/rubinius'].each do |interpreter|
['shotgun/rubinius'].each do |interpreter|
  puts interpreter
  Dir['test/benchmark/*/bm*.rb'].each do |file|
    results = []

    1.upto(ITERATIONS) do |i|
      start = Time.now

      command = "#{interpreter} #{file}"

      if file =~ /wycats\/bm_string[.]rb/ then
        command += %{ -x "String#unpack"}
      end

      command = command + ' > /dev/null 2>&1'

      if system command
        results << Time.now - start
      end
    end

    if results.length == ITERATIONS
      if ITERATIONS == 1
        puts results.first
      else
        puts results.slice(1..-1).inject {|sum, n| sum + n } / (ITERATIONS-1)
      end
    else
      puts "Errored"
    end
  end
end

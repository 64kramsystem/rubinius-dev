#!/usr/bin/env ruby

file = ARGV.shift
if file == "-g"
  gdb = true
  file = ARGV.shift
elsif file == "-v"
  valgrind = true
  file = ARGV.shift
end

comp = "#{file}c"

compile = true

if File.exists?(comp)
  if File.mtime(file) > File.mtime(comp)
    compile = true
  else
    compile = false
  end
end

if compile
  puts "Compiling #{file}"
  `bin/rcompile #{file}`
end


if gdb
  cmd = "gdb --args ./shotgun/rubinius lib/kernel.rbc #{comp}"
elsif valgrind
  cmd = "valgrind --leak-check=full ./shotgun/rubinius lib/kernel.rbc #{comp}"
else
  cmd = "./shotgun/rubinius lib/kernel.rbc #{comp}"
end
puts "RUNNING: #{cmd}"

exec cmd

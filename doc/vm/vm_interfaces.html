<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Rubinius</title>
    <link rel="stylesheet" href="op_codes.css" type="text/css" />
  </head>
  <body>
    <h2>Interfacing with the Rubinius VM</h2>


Rubinius provides three different mechanisms for interfacing with the VM:
	<ul>
	<li>Primitives</li>
		<li>Foregin Function Interface (FFI)</li>
		<li>Subtend</li>
	</ul>


	<h3>Primitives</h3>


	<p>Primitives provide a means for Ruby code to drop-down to the virtual machine level in order to manipulate the machine directly. Primitives provide the ability to implement functionality on Ruby classes that is impractical or impossible from pure Ruby. Primitives are one-way; compile-time constructs, typically used to generate C code that manipulates the state of the machine directly.</p>


	<h4>When to Use</h4>


	<p>Primitives should be used when the goal is to manipulate the Rubinius machine only. If an external library function is involved, <span class="caps">FFI</span> should be used instead.</p>


	<h3>Foreign Function Interface (FFI)</h3>


	<p><span class="caps">FFI</span> is a means for Ruby code to declare an external function that can then be called like any other Ruby method. It uses <span class="caps">GNU</span> Lightning to generate native machine code on-the-fly, in order to invoke an external library function at run-time without any compilation. See <a href="http://rubini.us/pages/ffi">here</a> for additional details on how to use <span class="caps">FFI</span>.</p>


	<h4>When to Use</h4>


	<p><span class="caps">FFI</span> should be used whenever access to an external library is required from Ruby.</p>


	<h3>Subtend</h3>


	<p>Subtend is the <span class="caps">MRI</span> compatible C interface that allows external code to call Ruby. It is provided so that external libraries written to the <span class="caps">MRI C</span>-interface can work with Rubinius, with only a re-compile required. See <a href="http://blog.fallingsnow.net/2007/03/06/subtend-version-1-is-in/">here</a> for more information.</p>


	<h4>When to Use</h4>


	<p>Subtend should be used when external code needs to interact with Ruby code. Unlike the other two interfaces, Subtend is an inbound interface to Ruby/Rubinius.</p>
  </body>
<html>

---
mnemonic: set_local_depth
operation: >-
  Updates the value of a local variable contained in an enclosing scope
format: set_local_depth depth local
opcode: 86
stack_before:
  - value
  - ...
stack_after:
  - value
  - ...
description: >-
  Uses the _value_ on the top of the stack to update the value of the local
  variable _local_ in an enclosing scope. The value is then pushed back onto the
  stack, to represent the return value from the expression.
example: >-
  foo.each do |i|
  
    bar.each do |j|
  
      i = i + j  # i is a local variable from enclosing scope at depth 1
  
    end
  
  end
source: |-
    next_int;
    k = _int;
    next_int;
    t3 = stack_pop();
    t1 = c->active_context;
        
    for(j = 0; j < k; j++) {
      t2 = blokctx_env(state, t1);
      t1 = blokenv_get_home_block(t2);
    }
    
    t2 = blokctx_locals(state, t1);
    if(t2->gc_zone == 0) {
      sassert(_int < NUM_FIELDS(t2) && "locals tuple sized wrong");
      fast_unsafe_set(t2, _int, t3);
    } else {
      tuple_put(state, t2, _int, t3);
    }
    stack_push(t3);
    

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title>Rubinius Virtual Machine OpCode: set_cache_index</title>
        <link rel="stylesheet" href="../op_codes.css" type="text/css" />
    </head>
    <body>
        <div id="set_cache_index">
            <h2>set_cache_index</h2>
            <b>Byte code:</b> <i>0x43</i>

            <h3>Operation</h3>
            
            <p>Sets the cache index for a method from a call site</p>
            

            <h3>Format</h3>
            
            <b>set_cache_index</b>
            <i>idx</i>

            <h3>Stack</h3>
            <div class="stack">
                <table>
                    <tfoot>
                        <tr><th>Before</th><th>&nbsp;<th>After<th></tr>
                    </tfoot>
                    <tbody>
                        <tr>
                            <td><table><tr><td>...</td></tr></table></td>
                            <td>=&gt;</td>
                            <td><table><tr><td>...</td></tr></table></td>
                        <tr>
                    </tbody>
                </table>
            </div>

            <h3>Description</h3>
            
            <p>Sets the cache index to be used in the polymorphic inline cache (PIC) for the cache entry for a class, module, or method that is the subject of one of the following op codes:</p><p>    <i>open_class</i>, <i>find_const</i>, <i>add_method</i>, <i>attach_method</i>, <i>send_method</i>,</p><p><i>open_class_under</i>, <i>open_module</i>, or <i>open_module_under</i>.</p>
            

            
            <div class="notes">
                <h4>Notes</h4>
                <p>When the assembler encounters one of the above opcodes, it assigns the next index for a cache entry in the PIC for the opcode, and inserts a <b>set_cache_index</b> operation into the byte code just before the op code in question. The call site then retains a cache of the receiving object / method when the initial constant lookup or method dispatch occurs, so subsequent execution of the same byte code can perform a fast check to confirm the validity of the cache, and then return the constant or dispatch the method immediately if the cache is valid. This greatly speeds constant lookup and method dispatch, since the search step can be skipped.</p>
            </div>
            

            

            

            
            <div id="set_cache_index_source" class="source">
                <h4>Source</h4>
                <pre>next_int;
c->cache_index = _int;</pre>
            <div>
            
        </div>
    </body>
</html>
